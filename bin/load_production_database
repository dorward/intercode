#!/usr/bin/env bash

echo 'Loading database into local Postgres'
createdb -U postgres intercode_production_tmp
cat intercode_production_tmp.sql | psql -U postgres intercode_production_tmp

echo 'Changing convention domains and names for development'
echo "UPDATE conventions SET domain = regexp_replace(lower(name), '[^a-z0-9]', '', 'g') || '.intercode.test', name = name || ' [dev]';" | psql -U postgres intercode_production_tmp

echo 'Dropping intercode_development database'
dropdb -U postgres intercode_development

echo 'Recreating intercode_development from production data'
createdb -U postgres -T intercode_production_tmp intercode_development

echo 'Dropping tmp database'
dropdb -U postgres intercode_production_tmp
